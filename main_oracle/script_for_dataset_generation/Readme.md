# panda_sim_for_dataset

This simulation consists in an environment composed of a Franka Emika Panda robot, with attached at the end-effector a sphere, coming in contact with a fixed plane.
The robot is controlled via an impedance controller that activates the force control when in proximity of the table, following the reference force along the _z_-axis, while the movement along the _x_ and _y_-axis follow a reference position.
The force control is effectuated through a PI controller tuned from the classic control theory.
The input position and the force reference given to the robot are obtained exploiting the utilities of [trajectories_generation_utilities](../../trajectories_generation_utilities).
These tools are used to generate an approaching trajectory and, once in contact with the table, random trajectories.
Every time a new trajectory starts, the simulation is restarted.
The contact data of the simulation are retrieved and processed through the functions in [dataset_utilities](../../dataset_generation_utilities/src/dataset_utilities/), to then populate the dataset.
Once the dataset is built can be used to train a neural networks ensemble, used as force estimator, through the script in [script_for_nn_training](../../test_oracle/script_for_nn_training/)

## How to launch it

Make sure you have followed the instructions in [getting started](../../Readme.md)

```sh
    cd 
    cd environment_identification
    source set_env.sh
    cd main_oracle/script_for_dataset_generation
    python3 panda_sim_for_dataset.py
```

## Expected output

The simulation will generate three main outputs: thirteen figures and three .csv files for each trajectory and a single .csv file for each simulation containing the final dataset.
The figures represent:

1. the generated trajectory followed by the end-effector along the _x_ and _y_-axis;
2. the generated force followed by the end-effector along the _z_-axis;
3. the forces generated by the contact along the directions _x_, _y_, _z_ and their magnitude;
4. the penetration and velocity of penetration;
5. the torques applied to the first six joints (useful for checking non-saturation);
6. the end-effector position along the directions _x_, _y_ over time and on the plane;
7. the end-effector velocity along the directions _x_, _y_ over time;
8. the contact force along time;
9. The last plot allow a graphical display of the data that are stored in the dataset as well as a comparison between before and after processing the data:

These graphs provide graphical display tools that may or may not be used.
If it is required to simulate a large number of trajectory, it is not advisable to generate all the plots but only those of the data you are most interested in.

The .csv files are contained in the folder _output_, divided into four subfolders:

* _traj_generated_csv_: store the generated trajectories (one file per trajectory)
* _traj_resampled_csv_: store the resampled trajectories (one file per trajectory)
* _unprocessed_csv_: store the contact data retrieved by the simulation (one file per trajectory)
* _processed_csv_: store the processed contact data (one file per simulation)
